<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ผู้บริหาร อาจารย์ บุคลากร - คณะครุศาสตร์</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="assets/logo.png" type="image/png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .personnel-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            padding: 20px 0;
            justify-content: center;
        }

        /* Specific for Dean to be centered */
        .dean-section {
            display: flex;
            justify-content: center;
            margin-bottom: 50px;
        }

        .personnel-card {
            width: 300px;
            /* Standard fixed width */
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-align: center;
            padding-bottom: 20px;
            border: 1px solid #eee;
        }

        .personnel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .person-img {
            width: 100%;
            height: 320px;
            /* Portrait aspect ratio */
            object-fit: cover;
            object-position: top;
            background-color: #f0f0f0;
        }

        /* Fallback if no image */
        .person-img.placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: #ccc;
            background: #f8f9fa;
        }

        .person-info {
            padding: 20px 15px 5px;
        }

        .person-name {
            font-size: 1.1rem;
            /* Reduced from 1.25rem */
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
            line-height: 1.4;
            padding: 0 10px;
        }

        .person-position {
            font-size: 0.9rem;
            /* Reduced from 1rem */
            color: #666;
            font-weight: 300;
            line-height: 1.4;
            padding: 0 10px;
        }

        .section-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .section-header h2 {
            font-size: 2rem;
            color: var(--primary-dark);
            font-weight: 700;
        }

        /* Loading State */
        .loading-spinner {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        /* Accordion Styles */
        .accordion-item {
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #f0f4f8;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .accordion-header {
            background-color: #f8fbff;
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.2s;
        }

        .accordion-header:hover {
            background-color: #f1f8fe;
        }

        .accordion-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.2rem;
            color: #1a3c6d;
            /* Dark Blue from theme */
            font-weight: 600;
            flex: 1;
        }

        .accordion-icon-left {
            color: #6c757d;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        /* Specific colors for icon if needed, e.g. based on faculty. For now generic. */
        .accordion-icon-left i {
            /* Gradient text? No, simple color */
            color: #5a7499;
        }

        .accordion-icon-right {
            color: #adb5bd;
            transition: transform 0.3s ease;
        }

        .accordion-content {
            display: none;
            /* Default hidden */
            padding: 30px 20px;
            background: #fff;
            border-top: 1px solid #f0f4f8;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dean-section {
            display: flex;
            justify-content: center;
            margin-bottom: 50px;
        }
    </style>
</head>

<body>

    <!-- Top Banner -->
    <div class="page-banner">
        <img src="assets/edu-topbanner.png" alt="Top Banner" style="width: 100%; height: auto; display: block;">
    </div>

    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <img src="assets/logo-name.png" alt="EDU MCRU">
            </a>
            <div class="menu-toggle" id="mobile-menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">หน้าหลัก</a></li>
                <li class="dropdown">
                    <a href="#" class="nav-link active">เกี่ยวกับคณะ <i class="fa-solid fa-chevron-down"></i></a>
                    <ul class="dropdown-menu">
                        <!-- 2.1 General Info -->
                        <li class="dropdown-submenu">
                            <a href="#" class="dropdown-item dropdown-submenu-toggle">ข้อมูลทั่วไป</a>
                            <ul class="dropdown-menu">
                                <li><a href="history.html">ประวัติความเป็นมา</a></li>
                                <li><a href="vision.html">ปรัชญา วิสัยทัศน์ พันธกิจ</a></li>
                            </ul>
                        </li>
                        <!-- 2.2 Administration -->
                        <li class="dropdown-submenu">
                            <a href="#" class="dropdown-item dropdown-submenu-toggle">การบริหาร</a>
                            <ul class="dropdown-menu">
                                <li><a href="structure.html">โครงสร้าง</a></li>
                                <li><a href="board.html">คณะกรรมการประจำคณะ</a></li>
                                <li><a href="deans_list.html">ทำเนียบคณบดี</a></li>
                                <li><a href="personnel.html">ผู้บริหาร อาจารย์ บุคลากร</a></li>
                            </ul>
                        </li>
                        <!-- Other Items -->
                        <li><a href="operation_plan.html">แผนการดำเนินงาน</a></li>
                        <li><a href="operation_results.html">ผลการดำเนินงาน</a></li>
                        <li><a href="qa.html">ประกันคุณภาพการศึกษา</a></li>
                        <li><a href="ita.html">ความโปร่งใส่ (ITA)</a></li>
                    </ul>
                </li>
                <li><a href="courses.html" class="nav-link">หลักสูตร</a></li>
                <li class="dropdown">
                    <a href="#departments" class="nav-link">หน่วยงาน <i class="fa-solid fa-chevron-down"></i></a>
                    <ul class="dropdown-menu">
                        <li><a href="teacher_pro_dev.html">ศูนย์พัฒนาวิชาชีพครู</a></li>
                        <li><a href="thantawan_school.html">โรงเรียนสาธิตอนุบาลทานตะวัน</a></li>
                    </ul>
                </li>
                <li><a href="documents.html" class="nav-link">เอกสารเผยแพร่</a></li>
                <li><a href="services.html" class="nav-link">บริการ</a></li>
                <li><a href="index.html#contact" class="nav-link">ติดต่อเรา</a></li>

            </ul>
        </div>
    </nav>

    <header class="page-header"
        style="background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); padding: 60px 0; color: white;">
        <div class="container"
            style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <h1 class="fade-in-up text-center">ผู้บริหาร อาจารย์ บุคลากร</h1>
            <p class="fade-in-up text-center" style="transition-delay: 0.1s;">คณะครุศาสตร์
                มหาวิทยาลัยราชภัฏหมู่บ้านจอมบึง</p>
        </div>
    </header>

    <section class="section-padding">
        <div class="container">
            <!-- Tabs -->
            <div class="tab-nav">
                <button class="tab-btn active" onclick="openTab(event, 'executives')">ผู้บริหาร</button>
                <button class="tab-btn" onclick="openTab(event, 'lecturers')">อาจารย์</button>
                <button class="tab-btn" onclick="openTab(event, 'staff')">บุคลากร</button>
            </div>

            <!-- Tab 1: Executives -->
            <div id="executives" class="tab-content" style="display: block;">
                <div id="executives-list" class="fade-in-up">
                    <div class="loading-spinner"><i class="fa-solid fa-spinner fa-spin fa-2x"></i></div>
                </div>
            </div>

            <!-- Tab 2: Lecturers -->
            <div id="lecturers" class="tab-content">
                <div id="lecturers-list" class="fade-in-up">
                    <div class="loading-spinner"><i class="fa-solid fa-spinner fa-spin fa-2x"></i></div>
                </div>
            </div>

            <!-- Tab 3: Staff -->
            <div id="staff" class="tab-content">
                <div id="staff-list" class="fade-in-up">
                    <div class="loading-spinner"><i class="fa-solid fa-spinner fa-spin fa-2x"></i></div>
                </div>
            </div>

        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadPersonnel('executive', 'executives-list');
            loadPersonnel('lecturer', 'lecturers-list');
            loadPersonnel('staff', 'staff-list');
        });

        async function loadPersonnel(type, containerId) {
            const container = document.getElementById(containerId);
            try {
                const res = await fetch(`/api/personnel?type=${type}`);
                if (!res.ok) throw new Error('API Error');
                // Force retry once if 500 (might be db connection warming up)

                const data = await res.json();

                // Custom Sort for Staff
                if (type === 'staff') {
                    data.sort((a, b) => {
                        const posA = (a.position || '').trim();
                        const posB = (b.position || '').trim();

                        // Check for 'Head of Office' (หัวหน้าสำนักงาน)
                        const isHeadA = posA.includes('หัวหน้าสำนักงาน');
                        const isHeadB = posB.includes('หัวหน้าสำนักงาน');

                        // 1. Head of Office first
                        if (isHeadA && !isHeadB) return -1;
                        if (!isHeadA && isHeadB) return 1;

                        // Check if meaningful position exists (not empty or '-')
                        const hasPosA = posA && posA !== '-';
                        const hasPosB = posB && posB !== '-';

                        // 2. Has Position comes before No Position
                        if (hasPosA && !hasPosB) return -1;
                        if (!hasPosA && hasPosB) return 1;

                        // 3. Alphabetical Sort by Position (Thai)
                        if (hasPosA && hasPosB) {
                            return posA.localeCompare(posB, 'th');
                        }

                        // 4. If same position status, sort by Name
                        return a.name.localeCompare(b.name, 'th');
                    });
                }

                if (!Array.isArray(data) || data.length === 0) {
                    // If purely empty
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <i class="fa-regular fa-user" style="font-size: 3rem; margin-bottom: 10px;"></i>
                            <p>ยังไม่มีข้อมูลในส่วนนี้</p>
                        </div>
                    `;
                    return;
                }

                // Special layout for Executives: Dean separate, Vice Deans in grid
                let htmlStr = '';

                if (type === 'executive') {
                    // Executive: Dean first (no change)
                    const dean = data.find(p => (p.group_name === 'Dean') || p.position === 'คณบดีคณะครุศาสตร์');
                    // Others: Vice Deans, sort by Name if multiple? Or position? Default by name for now unless specified.
                    // User didn't specify sort for Vice Deans, lets do Name.
                    const others = data.filter(p => p !== dean).sort((a, b) => a.name.localeCompare(b.name, 'th'));

                    if (dean) {
                        // Combined Name
                        const deanName = (dean.academic_title || '') + dean.name;
                        htmlStr += `
                            <div class="dean-section">
                                <div class="personnel-card">
                                    ${renderImage(dean)}
                                    <div class="person-info">
                                        <div class="person-name">${deanName}</div>
                                        <div class="person-position">${dean.position}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }

                    if (others.length > 0) {
                        htmlStr += `<div class="section-header"><h2>รองคณบดี</h2></div>`;
                        htmlStr += '<div class="personnel-grid">';
                        others.forEach(p => {
                            htmlStr += renderCard(p);
                        });
                        htmlStr += '</div>';
                    }

                } else if (type === 'staff') {
                    // Staff: Head of Office first
                    const head = data.find(p => (p.position || '').includes('หัวหน้าสำนักงาน'));

                    // Sorting Rule 2: If Staff, Sort Position by Alphabet. Empty position goes last.
                    let others = data.filter(p => p !== head);
                    others.sort((a, b) => {
                        let posA = a.position ? a.position.trim() : '';
                        let posB = b.position ? b.position.trim() : '';

                        if (posA === '-') posA = '';
                        if (posB === '-') posB = '';

                        if (posA && !posB) return -1;
                        if (!posA && posB) return 1;

                        return posA.localeCompare(posB, 'th');
                    });

                    if (head) {
                        htmlStr += `
                            <div class="dean-section">
                                ${renderCard(head, true)} 
                            </div>
                        `;
                    }

                    if (others.length > 0) {
                        htmlStr += '<div class="personnel-grid">';
                        others.forEach(p => {
                            htmlStr += renderCard(p);
                        });
                        htmlStr += '</div>';
                    }

                } else if (type === 'lecturer') {
                    // Lecturer: Group by Department
                    const depts = [...new Set(data.map(p => p.department || 'อื่นๆ'))].sort((a, b) => {
                        if (a === 'อื่นๆ') return 1;
                        if (b === 'อื่นๆ') return -1;
                        return a.localeCompare(b, 'th');
                    });

                    depts.forEach((dept, index) => {
                        const deptMembers = data.filter(p => (p.department || 'อื่นๆ') === dept);
                        if (deptMembers.length === 0) return;

                        const chair = deptMembers.find(p => (p.position || '').includes('ประธานสาขา'));
                        const members = deptMembers.filter(p => p !== chair).sort((a, b) => a.name.localeCompare(b.name, 'th'));

                        const deptId = `dept-${index}`;

                        // Icon selection based on dept (Optional simple mapping)
                        let iconClass = 'fa-graduation-cap';
                        if (dept.includes('เทคโนโลยี')) iconClass = 'fa-desktop';
                        else if (dept.includes('ภาษา')) iconClass = 'fa-language';
                        else if (dept.includes('ปฐมวัย')) iconClass = 'fa-shapes';
                        else if (dept.includes('ประถม')) iconClass = 'fa-book-open';
                        else if (dept.includes('พลศึกษา')) iconClass = 'fa-person-running';
                        else if (dept.includes('วิชาชีพครู')) iconClass = 'fa-chalkboard-user';

                        htmlStr += `
                            <div class="accordion-item">
                                <div class="accordion-header" onclick="toggleDept('${deptId}')">
                                    <div class="accordion-title">
                                        <div class="accordion-icon-left"><i class="fa-solid ${iconClass}"></i></div>
                                        <span>${dept}</span>
                                    </div>
                                    <div class="accordion-icon-right">
                                        <i id="icon-${deptId}" class="fa-solid fa-chevron-down"></i>
                                    </div>
                                </div>
                                
                                <div id="${deptId}" class="accordion-content">
                         `;

                        if (chair) {
                            htmlStr += `
                                <div class="dean-section">
                                     ${renderCard(chair, true)}
                                </div>
                            `;
                        }

                        if (members.length > 0) {
                            htmlStr += '<div class="personnel-grid">';
                            members.forEach(p => {
                                htmlStr += renderCard(p);
                            });
                            htmlStr += '</div>';
                        }

                        htmlStr += '</div>'; // End content
                        htmlStr += '</div>'; // End item
                    });
                } else {
                    // Fallback
                    htmlStr += '<div class="personnel-grid">';
                    data.forEach(p => {
                        htmlStr += renderCard(p);
                    });
                    htmlStr += '</div>';
                }

                container.innerHTML = htmlStr;

            } catch (error) {
                console.error(error);
                container.innerHTML = '<p class="text-center text-danger">เกิดข้อผิดพลาดในการโหลดข้อมูล</p>';
            }
        }

        function toggleDept(id) {
            const content = document.getElementById(id);
            const icon = document.getElementById('icon-' + id);

            // Toggle Logic
            if (getComputedStyle(content).display === 'none') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)'; // Chevron up
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)'; // Chevron down
            }
        }

        function renderCard(person) {
            const fullName = (person.academic_title || '') + person.name;
            let deptText = person.department ? `<div style="font-size:0.9rem; margin-top:5px; color:#888;">${person.department}</div>` : '';
            if (person.type === 'lecturer') deptText = '';

            return `
                <div class="personnel-card">
                    ${renderImage(person)}
                    <div class="person-info">
                        <div class="person-name">${fullName}</div>
                        <div class="person-position">${person.position}</div>
                        ${deptText}
                    </div>
                </div>
            `;
        }

        function renderImage(person) {
            let content = '';
            if (person.image_url) {
                // Ensure absolute path if relative
                // API saves as /uploads/filename.ext
                const imgPath = person.image_url.startsWith('http') || person.image_url.startsWith('/') ? person.image_url : '/' + person.image_url;
                content = `<img src="${imgPath}" alt="${person.name}" class="person-img">`;
            } else {
                content = `
                    <div class="person-img placeholder">
                        <i class="fa-solid fa-user"></i>
                    </div>
                `;
            }

            if (person.profile_link) {
                return `<a href="${person.profile_link}" target="_blank" rel="noopener noreferrer" style="display:block; text-decoration:none;">${content}</a>`;
            }
            return content;
        }
    </script>

    <footer id="contact">
        <div class="container">
            <div class="footer-content grid-4">
                <div class="footer-col">
                    <h3>ติดต่อเรา</h3>
                    <p>คณะครุศาสตร์ <br>มหาวิทยาลัยราชภัฏหมู่บ้านจอมบึง</p>
                    <p>46 หมู่ 3 ต.จอมบึง อ.จอมบึง <br>จ.ราชบุรี 70150</p>
                </div>
                <div class="footer-col">
                    <h3>ลิงก์ด่วน</h3>
                    <ul>
                        <li><a href="#">ระบบบริการการศึกษา</a></li>
                        <li><a href="#">ห้องสมุด</a></li>
                        <li><a href="#">ปฏิทินวิชาการ</a></li>
                        <li><a href="#">ดาวน์โหลดเอกสาร</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>ติดตามเรา</h3>
                    <div class="social-links">
                        <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                        <a href="#"><i class="fa-brands fa-line"></i></a>
                        <a href="#"><i class="fa-brands fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3>สำหรับผู้ดูแลระบบ</h3>
                    <a href="login.html" class="btn btn-outline text-white btn-sm">เข้าสู่ระบบ</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Education Faculty, Muban Chombueng Rajabhat University. All Rights Reserved.
                </p>
            </div>
        </div>
    </footer>
    <script src="script.js"></script>
</body>

</html>